<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.blogsystemdemo3.mapper.BlogMapper">
    <insert id="insertBlogDesc" keyProperty="blogId" parameterType="com.example.blogsystemdemo3.model.Blog" useGeneratedKeys="true">
        insert into blog
        values (null ,#{title},#{blogDesc},#{postTime},#{userId},0);
    </insert>

    <insert id="insertBlogContent">
        insert into blogDetail values (#{blogId},#{content});
    </insert>

    <select id="getAllBlogDesc" resultType="com.example.blogsystemdemo3.model.Blog">
        select * from blog order by postTime desc;
    </select>

    <select id="getBlogById" resultType="com.example.blogsystemdemo3.model.Blog">
        select blog.blogId blogId,blog.title title,blog.postTime postTime,blog.userId userId,blog.likes likes,blogDetail.content content
        from blog,blogDetail
        where blog.blogId = #{blogId} and blog.blogId = blogDetail.blogId;
    </select>

    <update id="incLikes">
        update blog set likes = likes + 1 where blogId = #{blogId};
    </update>

    <select id="getLikes" resultType="int">
        select likes from blog where blogId = #{blogId};
    </select>

    <update id="updateBlogDesc">
        update blog set blogDesc = #{blogDesc},title= #{title} where blogId = #{blogId};
    </update>

    <update id="updateBlogContent">
        update BlogDetail set content = #{content} where blogId = #{blogId};
    </update>

    <delete id="deleteBlogDesc">
        delete from blog where blogId = #{blogId};
    </delete>

    <delete id="deleteBlogContent">
        delete from blogDetail where blogId = #{blogId};
    </delete>

    <select id="getUserIdByBlogId" resultType="int">
        select userId from blog where blogId = #{blogId};
    </select>

    <select id="getBlogsByUserId" resultType="com.example.blogsystemdemo3.model.Blog">
        select blogId,title,blogDesc from blog where userId = #{userId};
    </select>

</mapper>